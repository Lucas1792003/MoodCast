{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/waiya/Desktop/MoodCast/MoodCast/src/app/api/geocode/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\"\r\nimport type { GeocodeResult } from \"../../../lib/weather-types\"\r\n\r\nexport const runtime = \"nodejs\"\r\n\r\nfunction cleanQuery(q: string) {\r\n  return q\r\n    .replace(/\\bsubdistrict\\b/gi, \"\")\r\n    .replace(/\\bdistrict\\b/gi, \"\")\r\n    .replace(/\\bprovince\\b/gi, \"\")\r\n    .replace(/\\s+/g, \" \")\r\n    .trim()\r\n}\r\n\r\nasync function openMeteoGeocode(q: string) {\r\n  const url = `https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(\r\n    q\r\n  )}&count=1&language=en&format=json`\r\n\r\n  const res = await fetch(url, { next: { revalidate: 300 } })\r\n  if (!res.ok) return null\r\n\r\n  const data = await res.json()\r\n  const r = data?.results?.[0]\r\n  if (!r) return null\r\n\r\n  const result: GeocodeResult = {\r\n    name: r.name,\r\n    country: r.country,\r\n    latitude: r.latitude,\r\n    longitude: r.longitude,\r\n  }\r\n  return result\r\n}\r\n\r\nasync function nominatimGeocode(q: string) {\r\n  const url = `https://nominatim.openstreetmap.org/search?format=jsonv2&addressdetails=1&limit=1&q=${encodeURIComponent(\r\n    q\r\n  )}`\r\n\r\n  const res = await fetch(url, {\r\n    headers: {\r\n      \"User-Agent\": \"MoodCast/1.0\",\r\n      \"Accept-Language\": \"en\",\r\n    },\r\n    cache: \"no-store\",\r\n  })\r\n  if (!res.ok) return null\r\n\r\n  const data: any[] = await res.json()\r\n  const r = data?.[0]\r\n  if (!r) return null\r\n\r\n  const lat = Number(r.lat)\r\n  const lon = Number(r.lon)\r\n  if (!Number.isFinite(lat) || !Number.isFinite(lon)) return null\r\n\r\n  const addr = r.address ?? {}\r\n  const name =\r\n    addr.city ||\r\n    addr.town ||\r\n    addr.village ||\r\n    addr.municipality ||\r\n    addr.county ||\r\n    addr.state ||\r\n    r.name ||\r\n    \"Unknown\"\r\n\r\n  const result: GeocodeResult = {\r\n    name,\r\n    country: addr.country,\r\n    latitude: lat,\r\n    longitude: lon,\r\n  }\r\n  return result\r\n}\r\n\r\nexport async function GET(req: Request) {\r\n  const { searchParams } = new URL(req.url)\r\n  const qRaw = searchParams.get(\"q\")?.trim()\r\n\r\n  if (!qRaw) {\r\n    return NextResponse.json({ error: \"Missing q\" }, { status: 400 })\r\n  }\r\n\r\n  let result = await openMeteoGeocode(qRaw)\r\n\r\n  if (!result) {\r\n    const cleaned = cleanQuery(qRaw)\r\n    if (cleaned && cleaned !== qRaw) {\r\n      result = await openMeteoGeocode(cleaned)\r\n    }\r\n  }\r\n\r\n  if (!result) {\r\n    result = await nominatimGeocode(qRaw)\r\n  }\r\n\r\n  if (!result) {\r\n    return NextResponse.json({ error: \"No results\" }, { status: 404 })\r\n  }\r\n\r\n  return NextResponse.json(result)\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;;AAGO,MAAM,UAAU;AAEvB,SAAS,WAAW,CAAS;IAC3B,OAAO,EACJ,OAAO,CAAC,qBAAqB,IAC7B,OAAO,CAAC,kBAAkB,IAC1B,OAAO,CAAC,kBAAkB,IAC1B,OAAO,CAAC,QAAQ,KAChB,IAAI;AACT;AAEA,eAAe,iBAAiB,CAAS;IACvC,MAAM,MAAM,CAAC,oDAAoD,EAAE,mBACjE,GACA,gCAAgC,CAAC;IAEnC,MAAM,MAAM,MAAM,MAAM,KAAK;QAAE,MAAM;YAAE,YAAY;QAAI;IAAE;IACzD,IAAI,CAAC,IAAI,EAAE,EAAE,OAAO;IAEpB,MAAM,OAAO,MAAM,IAAI,IAAI;IAC3B,MAAM,IAAI,MAAM,SAAS,CAAC,EAAE;IAC5B,IAAI,CAAC,GAAG,OAAO;IAEf,MAAM,SAAwB;QAC5B,MAAM,EAAE,IAAI;QACZ,SAAS,EAAE,OAAO;QAClB,UAAU,EAAE,QAAQ;QACpB,WAAW,EAAE,SAAS;IACxB;IACA,OAAO;AACT;AAEA,eAAe,iBAAiB,CAAS;IACvC,MAAM,MAAM,CAAC,oFAAoF,EAAE,mBACjG,IACC;IAEH,MAAM,MAAM,MAAM,MAAM,KAAK;QAC3B,SAAS;YACP,cAAc;YACd,mBAAmB;QACrB;QACA,OAAO;IACT;IACA,IAAI,CAAC,IAAI,EAAE,EAAE,OAAO;IAEpB,MAAM,OAAc,MAAM,IAAI,IAAI;IAClC,MAAM,IAAI,MAAM,CAAC,EAAE;IACnB,IAAI,CAAC,GAAG,OAAO;IAEf,MAAM,MAAM,OAAO,EAAE,GAAG;IACxB,MAAM,MAAM,OAAO,EAAE,GAAG;IACxB,IAAI,CAAC,OAAO,QAAQ,CAAC,QAAQ,CAAC,OAAO,QAAQ,CAAC,MAAM,OAAO;IAE3D,MAAM,OAAO,EAAE,OAAO,IAAI,CAAC;IAC3B,MAAM,OACJ,KAAK,IAAI,IACT,KAAK,IAAI,IACT,KAAK,OAAO,IACZ,KAAK,YAAY,IACjB,KAAK,MAAM,IACX,KAAK,KAAK,IACV,EAAE,IAAI,IACN;IAEF,MAAM,SAAwB;QAC5B;QACA,SAAS,KAAK,OAAO;QACrB,UAAU;QACV,WAAW;IACb;IACA,OAAO;AACT;AAEO,eAAe,IAAI,GAAY;IACpC,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,IAAI,GAAG;IACxC,MAAM,OAAO,aAAa,GAAG,CAAC,MAAM;IAEpC,IAAI,CAAC,MAAM;QACT,OAAO,4JAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAY,GAAG;YAAE,QAAQ;QAAI;IACjE;IAEA,IAAI,SAAS,MAAM,iBAAiB;IAEpC,IAAI,CAAC,QAAQ;QACX,MAAM,UAAU,WAAW;QAC3B,IAAI,WAAW,YAAY,MAAM;YAC/B,SAAS,MAAM,iBAAiB;QAClC;IACF;IAEA,IAAI,CAAC,QAAQ;QACX,SAAS,MAAM,iBAAiB;IAClC;IAEA,IAAI,CAAC,QAAQ;QACX,OAAO,4JAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAa,GAAG;YAAE,QAAQ;QAAI;IAClE;IAEA,OAAO,4JAAY,CAAC,IAAI,CAAC;AAC3B"}}]
}